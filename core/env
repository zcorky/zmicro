#!/bin/bash

# realpath() {
#   OURPWD=$PWD
#   cd "$(dirname "$1")"
#   LINK=$(readlink "$(basename "$1")")
#   while [ "$LINK" ]; do
#     cd "$(dirname "$LINK")"
#     LINK=$(readlink "$(basename "$1")")
#   done
#   REALPATH="$PWD/$(basename "$1")"
#   cd "$OURPWD"
#   echo "$REALPATH"
# }

# CURRENT_DIR=$(realpath $(dirname "$0"))
TMP_ZMICRO_CONFIG_PATH=$ZMICRO_HOME/config
TMP_ZMICRO_CORE_PATH=$ZMICRO_HOME/core
TMP_ZMICRO_PLUGINS_PATH=$ZMICRO_HOME/plugins

# Load Base Config
. $TMP_ZMICRO_CONFIG_PATH/config

# @TODO override CORE_PATH
export CORE_PATH=$TMP_ZMICRO_CORE_PATH
export ZMICRO_PLUGIN_PATH=$TMP_ZMICRO_PLUGINS_PATH

# Load Doreamon Fns
# . $CORE_PATH/load
# . $CURRENT_DIR/load
\. $TMP_ZMICRO_CORE_PATH/load

# Load Config in TMP_ZMICRO_CONFIG_PATH
load_config $TMP_ZMICRO_CONFIG_PATH

# Load User Config
# @FIX install step doesnot generate ZMICRO_RC
[[ -f $ZMICRO_RC ]] && load_config $ZMICRO_RC

# Do for mac os
if [ "$(os_is_macos)" = "true" ]; then
  export ZMICRO_APP_LOGS_PATH=$HOME/.local/zmicro/logs
  export ZMICRO_APP_DATA_PATH=$HOME/.local/zmicro/data
fi