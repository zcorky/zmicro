#!/bin/bash

git::commit_message() {
  git log -1 --pretty=%B
}

git::commit_hash() {
  git rev-parse --short=9 HEAD
}

git::commit_timestamp() {
  local gitMainVersion=$(git --version | awk '{print $3}' | awk -F '.' '{print $1}')
  local gitSubVersion=$(git --version | awk '{print $3}' | awk -F '.' '{print $2}')

  if [ "$gitMainVersion" -ge "2" ] && [ "$gitSubVersion" -ge "7" ]; then
    git show -s --format=%cd --date="format:%Y-%m-%d"
  else
    git show -s --format=%cd --date=local
  fi
}

git::fix_permissions() {
  # fix unsafe repository
  git config --global -l | grep "safe.directory=\*" >> /dev/null 2>&1
  if [ "$?" != "0" ]; then
    git config --global --add safe.directory "*"
  fi
}

export -f git::commit_message
export -f git::commit_hash
export -f git::commit_timestamp

export -f git::fix_permissions
